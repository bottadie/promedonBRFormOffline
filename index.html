<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <base href="/">
    <title>Formulario médico de cirugias</title>
</head>
<body>
    Nueva nota <br>
    <form action="#">
        <div>
            <label for="contenido">Detalle de la operación</label>
            <input type="text" id="contenido">
        </div>
    </form>
    <button id="btnAgregar">Agregar</button>
    <button id ="btnBorrar">Borrar</button>
    <hr>
<button id="btnBasedDeDatos">Carga la base</button>
    <div id="resultado"></div>

    <script>

        window.addEventListener('load', () => {

            let baseDatos;
            let solicitudConexion = indexedDB.open('notasBd', 1);

            solicitudConexion.onsuccess = function(evento) {
                baseDatos = evento.target.result;
            }

            solicitudConexion.onerror = function(evento) {
                document.querySelector('#resultado').innerText = `Error al abrir la base de datos: ${evento.target.errorCode}`;
            }

            solicitudConexion.onupgradeneeded = function(evento) {
                baseDatos = event.target.result;

                let notas = baseDatos.createObjectStore('notas', {autoIncrement: true});
            }

            document.querySelector('#btnAgregar').addEventListener('click', function(evento) {
                let contenido = document.querySelector('#contenido').value;

                if(contenido.length){
                    let transaccion = baseDatos.transaction(['notas'], 'readwrite');
                    let notas = transaccion.objectStore('notas');

                    let nota = {contenido: contenido, estampa_tiempo: Date.now()};
                    notas.add(nota);

                    transaccion.oncomplete = function() {
                        document.querySelector('#resultado').innerText = 'La nota se ha creado de forma satisfactoria.';
                    }

                    transaccion.onerror = function(evento) {
                        document.querySelector('#resultado').innerText = `Error al intentar almacenar una nota: ${evento.target.errorCode}`;
                    }

                } else {
                    document.querySelector('#resultado').innerText = 'No ha escrito ningún valor en el campo contenido.';
                }
            });
        
     document.querySelector('#btnBorrar').addEventListener('click', function(evento) {
        
        let transaccion = baseDatos.transaction(['notas'], 'readwrite').objectStore('notas');
        var keyRange = IDBKeyRange.upperBound("0")
        let registro = transaccion.delete(keyRange)
                    
 //var display=  displayData();
//console.log(display)
   // document.querySelector('#resultado').innerText = `Estas haciendo clic ${info}`;

    });
        });
        
    </script>
    <script src="sw.js"></script>
    <script src="firebase.js" type='module' ></script>


</body>
</html>
